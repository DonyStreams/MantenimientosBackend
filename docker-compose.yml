services:
  tomee:
    build:
      context: .
      dockerfile: DockerFile
    ports:
      - "${TOMEE_PORT:-8081}:8080"
    container_name: tomee-server
    environment:
      - TZ=America/Guatemala
      - KEYCLOAK_URL=${KEYCLOAK_URL:-http://172.16.1.192:8080}
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - JAVA_TOOL_OPTIONS=-DDB_HOST=${DB_HOST} -DDB_PORT=${DB_PORT} -DDB_NAME=${DB_NAME} -DDB_USER=${DB_USER} -DDB_PASSWORD=${DB_PASSWORD}
    restart: unless-stopped
    volumes:
      # VOLUMEN PARA PERSISTIR IMÁGENES Y ARCHIVOS
      - inacif-files:/root/inacif-imagenes
      - inacif-contracts:/root/contratos-archivos
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/MantenimientosBackend/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  # Volúmenes para persistir datos entre reinicios del contenedor
  inacif-files:
    driver: local
  inacif-contracts:
    driver: local

networks:
  default:
    name: inacif-network
    driver: bridge